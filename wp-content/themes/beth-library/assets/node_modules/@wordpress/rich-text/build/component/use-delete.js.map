{"version":3,"names":["_element","require","_compose","_keycodes","_remove","_removeLineSeparator","_isEmpty","useDelete","props","propsRef","useRef","current","useRefEffect","element","onKeyDown","event","keyCode","createRecord","handleChange","multilineTag","defaultPrevented","DELETE","BACKSPACE","currentValue","start","end","text","isReverse","length","remove","preventDefault","newValue","isEmptyLine","removeLineSeparator","addEventListener","removeEventListener"],"sources":["@wordpress/rich-text/src/component/use-delete.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRef } from '@wordpress/element';\nimport { useRefEffect } from '@wordpress/compose';\nimport { BACKSPACE, DELETE } from '@wordpress/keycodes';\n\n/**\n * Internal dependencies\n */\nimport { remove } from '../remove';\nimport { removeLineSeparator } from '../remove-line-separator';\nimport { isEmptyLine } from '../is-empty';\n\nexport function useDelete( props ) {\n\tconst propsRef = useRef( props );\n\tpropsRef.current = props;\n\treturn useRefEffect( ( element ) => {\n\t\tfunction onKeyDown( event ) {\n\t\t\tconst { keyCode } = event;\n\t\t\tconst { createRecord, handleChange, multilineTag } =\n\t\t\t\tpropsRef.current;\n\n\t\t\tif ( event.defaultPrevented ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( keyCode !== DELETE && keyCode !== BACKSPACE ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentValue = createRecord();\n\t\t\tconst { start, end, text } = currentValue;\n\t\t\tconst isReverse = keyCode === BACKSPACE;\n\n\t\t\t// Always handle full content deletion ourselves.\n\t\t\tif ( start === 0 && end !== 0 && end === text.length ) {\n\t\t\t\thandleChange( remove( currentValue ) );\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( multilineTag ) {\n\t\t\t\tlet newValue;\n\n\t\t\t\t// Check to see if we should remove the first item if empty.\n\t\t\t\tif (\n\t\t\t\t\tisReverse &&\n\t\t\t\t\tcurrentValue.start === 0 &&\n\t\t\t\t\tcurrentValue.end === 0 &&\n\t\t\t\t\tisEmptyLine( currentValue )\n\t\t\t\t) {\n\t\t\t\t\tnewValue = removeLineSeparator( currentValue, ! isReverse );\n\t\t\t\t} else {\n\t\t\t\t\tnewValue = removeLineSeparator( currentValue, isReverse );\n\t\t\t\t}\n\n\t\t\t\tif ( newValue ) {\n\t\t\t\t\thandleChange( newValue );\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\telement.addEventListener( 'keydown', onKeyDown );\n\t\treturn () => {\n\t\t\telement.removeEventListener( 'keydown', onKeyDown );\n\t\t};\n\t}, [] );\n}\n"],"mappings":";;;;;;AAGA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,QAAA,GAAAD,OAAA;AACA,IAAAE,SAAA,GAAAF,OAAA;AAKA,IAAAG,OAAA,GAAAH,OAAA;AACA,IAAAI,oBAAA,GAAAJ,OAAA;AACA,IAAAK,QAAA,GAAAL,OAAA;AAZA;AACA;AACA;;AAKA;AACA;AACA;;AAKO,SAASM,SAASA,CAAEC,KAAK,EAAG;EAClC,MAAMC,QAAQ,GAAG,IAAAC,eAAM,EAAEF,KAAM,CAAC;EAChCC,QAAQ,CAACE,OAAO,GAAGH,KAAK;EACxB,OAAO,IAAAI,qBAAY,EAAIC,OAAO,IAAM;IACnC,SAASC,SAASA,CAAEC,KAAK,EAAG;MAC3B,MAAM;QAAEC;MAAQ,CAAC,GAAGD,KAAK;MACzB,MAAM;QAAEE,YAAY;QAAEC,YAAY;QAAEC;MAAa,CAAC,GACjDV,QAAQ,CAACE,OAAO;MAEjB,IAAKI,KAAK,CAACK,gBAAgB,EAAG;QAC7B;MACD;MAEA,IAAKJ,OAAO,KAAKK,gBAAM,IAAIL,OAAO,KAAKM,mBAAS,EAAG;QAClD;MACD;MAEA,MAAMC,YAAY,GAAGN,YAAY,CAAC,CAAC;MACnC,MAAM;QAAEO,KAAK;QAAEC,GAAG;QAAEC;MAAK,CAAC,GAAGH,YAAY;MACzC,MAAMI,SAAS,GAAGX,OAAO,KAAKM,mBAAS;;MAEvC;MACA,IAAKE,KAAK,KAAK,CAAC,IAAIC,GAAG,KAAK,CAAC,IAAIA,GAAG,KAAKC,IAAI,CAACE,MAAM,EAAG;QACtDV,YAAY,CAAE,IAAAW,cAAM,EAAEN,YAAa,CAAE,CAAC;QACtCR,KAAK,CAACe,cAAc,CAAC,CAAC;QACtB;MACD;MAEA,IAAKX,YAAY,EAAG;QACnB,IAAIY,QAAQ;;QAEZ;QACA,IACCJ,SAAS,IACTJ,YAAY,CAACC,KAAK,KAAK,CAAC,IACxBD,YAAY,CAACE,GAAG,KAAK,CAAC,IACtB,IAAAO,oBAAW,EAAET,YAAa,CAAC,EAC1B;UACDQ,QAAQ,GAAG,IAAAE,wCAAmB,EAAEV,YAAY,EAAE,CAAEI,SAAU,CAAC;QAC5D,CAAC,MAAM;UACNI,QAAQ,GAAG,IAAAE,wCAAmB,EAAEV,YAAY,EAAEI,SAAU,CAAC;QAC1D;QAEA,IAAKI,QAAQ,EAAG;UACfb,YAAY,CAAEa,QAAS,CAAC;UACxBhB,KAAK,CAACe,cAAc,CAAC,CAAC;QACvB;MACD;IACD;IAEAjB,OAAO,CAACqB,gBAAgB,CAAE,SAAS,EAAEpB,SAAU,CAAC;IAChD,OAAO,MAAM;MACZD,OAAO,CAACsB,mBAAmB,CAAE,SAAS,EAAErB,SAAU,CAAC;IACpD,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;AACR"}