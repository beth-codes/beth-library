{"version":3,"names":["useRef","useRefEffect","toHTMLString","isCollapsed","slice","getTextContent","useCopyHandler","props","propsRef","current","element","onCopy","event","record","multilineTag","preserveWhiteSpace","ownerDocument","contains","activeElement","selectedRecord","plainText","tagName","toLowerCase","html","value","clipboardData","setData","preventDefault","type","execCommand","addEventListener","removeEventListener"],"sources":["@wordpress/rich-text/src/component/use-copy-handler.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRef } from '@wordpress/element';\nimport { useRefEffect } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport { toHTMLString } from '../to-html-string';\nimport { isCollapsed } from '../is-collapsed';\nimport { slice } from '../slice';\nimport { getTextContent } from '../get-text-content';\n\nexport function useCopyHandler( props ) {\n\tconst propsRef = useRef( props );\n\tpropsRef.current = props;\n\treturn useRefEffect( ( element ) => {\n\t\tfunction onCopy( event ) {\n\t\t\tconst { record, multilineTag, preserveWhiteSpace } =\n\t\t\t\tpropsRef.current;\n\t\t\tconst { ownerDocument } = element;\n\t\t\tif (\n\t\t\t\tisCollapsed( record.current ) ||\n\t\t\t\t! element.contains( ownerDocument.activeElement )\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst selectedRecord = slice( record.current );\n\t\t\tconst plainText = getTextContent( selectedRecord );\n\t\t\tconst tagName = element.tagName.toLowerCase();\n\n\t\t\tlet html = toHTMLString( {\n\t\t\t\tvalue: selectedRecord,\n\t\t\t\tmultilineTag,\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} );\n\n\t\t\tif ( tagName && tagName !== 'span' && tagName !== 'div' ) {\n\t\t\t\thtml = `<${ tagName }>${ html }</${ tagName }>`;\n\t\t\t}\n\n\t\t\tevent.clipboardData.setData( 'text/plain', plainText );\n\t\t\tevent.clipboardData.setData( 'text/html', html );\n\t\t\tevent.clipboardData.setData( 'rich-text', 'true' );\n\t\t\tevent.preventDefault();\n\n\t\t\tif ( event.type === 'cut' ) {\n\t\t\t\townerDocument.execCommand( 'delete' );\n\t\t\t}\n\t\t}\n\n\t\telement.addEventListener( 'copy', onCopy );\n\t\telement.addEventListener( 'cut', onCopy );\n\t\treturn () => {\n\t\t\telement.removeEventListener( 'copy', onCopy );\n\t\t\telement.removeEventListener( 'cut', onCopy );\n\t\t};\n\t}, [] );\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,MAAM,QAAQ,oBAAoB;AAC3C,SAASC,YAAY,QAAQ,oBAAoB;;AAEjD;AACA;AACA;AACA,SAASC,YAAY,QAAQ,mBAAmB;AAChD,SAASC,WAAW,QAAQ,iBAAiB;AAC7C,SAASC,KAAK,QAAQ,UAAU;AAChC,SAASC,cAAc,QAAQ,qBAAqB;AAEpD,OAAO,SAASC,cAAcA,CAAEC,KAAK,EAAG;EACvC,MAAMC,QAAQ,GAAGR,MAAM,CAAEO,KAAM,CAAC;EAChCC,QAAQ,CAACC,OAAO,GAAGF,KAAK;EACxB,OAAON,YAAY,CAAIS,OAAO,IAAM;IACnC,SAASC,MAAMA,CAAEC,KAAK,EAAG;MACxB,MAAM;QAAEC,MAAM;QAAEC,YAAY;QAAEC;MAAmB,CAAC,GACjDP,QAAQ,CAACC,OAAO;MACjB,MAAM;QAAEO;MAAc,CAAC,GAAGN,OAAO;MACjC,IACCP,WAAW,CAAEU,MAAM,CAACJ,OAAQ,CAAC,IAC7B,CAAEC,OAAO,CAACO,QAAQ,CAAED,aAAa,CAACE,aAAc,CAAC,EAChD;QACD;MACD;MAEA,MAAMC,cAAc,GAAGf,KAAK,CAAES,MAAM,CAACJ,OAAQ,CAAC;MAC9C,MAAMW,SAAS,GAAGf,cAAc,CAAEc,cAAe,CAAC;MAClD,MAAME,OAAO,GAAGX,OAAO,CAACW,OAAO,CAACC,WAAW,CAAC,CAAC;MAE7C,IAAIC,IAAI,GAAGrB,YAAY,CAAE;QACxBsB,KAAK,EAAEL,cAAc;QACrBL,YAAY;QACZC;MACD,CAAE,CAAC;MAEH,IAAKM,OAAO,IAAIA,OAAO,KAAK,MAAM,IAAIA,OAAO,KAAK,KAAK,EAAG;QACzDE,IAAI,GAAI,IAAIF,OAAS,IAAIE,IAAM,KAAKF,OAAS,GAAE;MAChD;MAEAT,KAAK,CAACa,aAAa,CAACC,OAAO,CAAE,YAAY,EAAEN,SAAU,CAAC;MACtDR,KAAK,CAACa,aAAa,CAACC,OAAO,CAAE,WAAW,EAAEH,IAAK,CAAC;MAChDX,KAAK,CAACa,aAAa,CAACC,OAAO,CAAE,WAAW,EAAE,MAAO,CAAC;MAClDd,KAAK,CAACe,cAAc,CAAC,CAAC;MAEtB,IAAKf,KAAK,CAACgB,IAAI,KAAK,KAAK,EAAG;QAC3BZ,aAAa,CAACa,WAAW,CAAE,QAAS,CAAC;MACtC;IACD;IAEAnB,OAAO,CAACoB,gBAAgB,CAAE,MAAM,EAAEnB,MAAO,CAAC;IAC1CD,OAAO,CAACoB,gBAAgB,CAAE,KAAK,EAAEnB,MAAO,CAAC;IACzC,OAAO,MAAM;MACZD,OAAO,CAACqB,mBAAmB,CAAE,MAAM,EAAEpB,MAAO,CAAC;MAC7CD,OAAO,CAACqB,mBAAmB,CAAE,KAAK,EAAEpB,MAAO,CAAC;IAC7C,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;AACR"}