{"version":3,"names":["useRef","useRefEffect","ENTER","insert","__unstableIsEmptyLine","isEmptyLine","__unstableInsertLineSeparator","insertLineSeparator","getBlockTransforms","findTransform","useDispatch","store","blockEditorStore","splitValue","useEnter","props","__unstableMarkAutomaticChange","propsRef","current","element","onKeyDown","event","defaultPrevented","keyCode","removeEditorOnlyFormats","value","onReplace","onSplit","onSplitMiddle","multilineTag","onChange","disableLineBreaks","onSplitAtEnd","preventDefault","_value","formats","canSplit","transforms","filter","type","transformation","item","regExp","test","text","transform","content","shiftKey","start","end","canSplitAtEnd","length","addEventListener","removeEventListener"],"sources":["@wordpress/block-editor/src/components/rich-text/use-enter.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRef } from '@wordpress/element';\nimport { useRefEffect } from '@wordpress/compose';\nimport { ENTER } from '@wordpress/keycodes';\nimport {\n\tinsert,\n\t__unstableIsEmptyLine as isEmptyLine,\n\t__unstableInsertLineSeparator as insertLineSeparator,\n} from '@wordpress/rich-text';\nimport { getBlockTransforms, findTransform } from '@wordpress/blocks';\nimport { useDispatch } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../../store';\nimport { splitValue } from './split-value';\n\nexport function useEnter( props ) {\n\tconst { __unstableMarkAutomaticChange } = useDispatch( blockEditorStore );\n\tconst propsRef = useRef( props );\n\tpropsRef.current = props;\n\treturn useRefEffect( ( element ) => {\n\t\tfunction onKeyDown( event ) {\n\t\t\tif ( event.defaultPrevented ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( event.keyCode !== ENTER ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst {\n\t\t\t\tremoveEditorOnlyFormats,\n\t\t\t\tvalue,\n\t\t\t\tonReplace,\n\t\t\t\tonSplit,\n\t\t\t\tonSplitMiddle,\n\t\t\t\tmultilineTag,\n\t\t\t\tonChange,\n\t\t\t\tdisableLineBreaks,\n\t\t\t\tonSplitAtEnd,\n\t\t\t} = propsRef.current;\n\n\t\t\tevent.preventDefault();\n\n\t\t\tconst _value = { ...value };\n\t\t\t_value.formats = removeEditorOnlyFormats( value );\n\t\t\tconst canSplit = onReplace && onSplit;\n\n\t\t\tif ( onReplace ) {\n\t\t\t\tconst transforms = getBlockTransforms( 'from' ).filter(\n\t\t\t\t\t( { type } ) => type === 'enter'\n\t\t\t\t);\n\t\t\t\tconst transformation = findTransform( transforms, ( item ) => {\n\t\t\t\t\treturn item.regExp.test( _value.text );\n\t\t\t\t} );\n\n\t\t\t\tif ( transformation ) {\n\t\t\t\t\tonReplace( [\n\t\t\t\t\t\ttransformation.transform( {\n\t\t\t\t\t\t\tcontent: _value.text,\n\t\t\t\t\t\t} ),\n\t\t\t\t\t] );\n\t\t\t\t\t__unstableMarkAutomaticChange();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( multilineTag ) {\n\t\t\t\tif ( event.shiftKey ) {\n\t\t\t\t\tif ( ! disableLineBreaks ) {\n\t\t\t\t\t\tonChange( insert( _value, '\\n' ) );\n\t\t\t\t\t}\n\t\t\t\t} else if ( canSplit && isEmptyLine( _value ) ) {\n\t\t\t\t\tsplitValue( {\n\t\t\t\t\t\tvalue: _value,\n\t\t\t\t\t\tonReplace,\n\t\t\t\t\t\tonSplit,\n\t\t\t\t\t\tonSplitMiddle,\n\t\t\t\t\t\tmultilineTag,\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\tonChange( insertLineSeparator( _value ) );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst { text, start, end } = _value;\n\t\t\t\tconst canSplitAtEnd =\n\t\t\t\t\tonSplitAtEnd && start === end && end === text.length;\n\n\t\t\t\tif ( event.shiftKey || ( ! canSplit && ! canSplitAtEnd ) ) {\n\t\t\t\t\tif ( ! disableLineBreaks ) {\n\t\t\t\t\t\tonChange( insert( _value, '\\n' ) );\n\t\t\t\t\t}\n\t\t\t\t} else if ( ! canSplit && canSplitAtEnd ) {\n\t\t\t\t\tonSplitAtEnd();\n\t\t\t\t} else if ( canSplit ) {\n\t\t\t\t\tsplitValue( {\n\t\t\t\t\t\tvalue: _value,\n\t\t\t\t\t\tonReplace,\n\t\t\t\t\t\tonSplit,\n\t\t\t\t\t\tonSplitMiddle,\n\t\t\t\t\t\tmultilineTag,\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\telement.addEventListener( 'keydown', onKeyDown );\n\t\treturn () => {\n\t\t\telement.removeEventListener( 'keydown', onKeyDown );\n\t\t};\n\t}, [] );\n}\n"],"mappings":"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"}