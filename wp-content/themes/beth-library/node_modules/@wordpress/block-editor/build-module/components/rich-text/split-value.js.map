{"version":3,"names":["isEmpty","split","toHTMLString","splitValue","value","pastedBlocks","onReplace","onSplit","onSplitMiddle","multilineTag","start","end","valueWithEnsuredSelection","blocks","before","after","hasPastedBlocks","length","lastPastedBlockIndex","isAfterOriginal","push","indexToSelect","initialPosition"],"sources":["@wordpress/block-editor/src/components/rich-text/split-value.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { isEmpty, split, toHTMLString } from '@wordpress/rich-text';\n\n/*\n * Signals to the RichText owner that the block can be replaced with two blocks\n * as a result of splitting the block by pressing enter, or with blocks as a\n * result of splitting the block by pasting block content in the instance.\n */\nexport function splitValue( {\n\tvalue,\n\tpastedBlocks = [],\n\tonReplace,\n\tonSplit,\n\tonSplitMiddle,\n\tmultilineTag,\n} ) {\n\tif ( ! onReplace || ! onSplit ) {\n\t\treturn;\n\t}\n\n\t// Ensure the value has a selection. This might happen when trying to split\n\t// an empty value before there was a `selectionchange` event.\n\tconst { start = 0, end = 0 } = value;\n\tconst valueWithEnsuredSelection = { ...value, start, end };\n\tconst blocks = [];\n\tconst [ before, after ] = split( valueWithEnsuredSelection );\n\tconst hasPastedBlocks = pastedBlocks.length > 0;\n\tlet lastPastedBlockIndex = -1;\n\n\t// Consider the after value to be the original it is not empty and the\n\t// before value *is* empty.\n\tconst isAfterOriginal = isEmpty( before ) && ! isEmpty( after );\n\n\t// Create a block with the content before the caret if there's no pasted\n\t// blocks, or if there are pasted blocks and the value is not empty. We do\n\t// not want a leading empty block on paste, but we do if split with e.g. the\n\t// enter key.\n\tif ( ! hasPastedBlocks || ! isEmpty( before ) ) {\n\t\tblocks.push(\n\t\t\tonSplit(\n\t\t\t\ttoHTMLString( {\n\t\t\t\t\tvalue: before,\n\t\t\t\t\tmultilineTag,\n\t\t\t\t} ),\n\t\t\t\t! isAfterOriginal\n\t\t\t)\n\t\t);\n\t\tlastPastedBlockIndex += 1;\n\t}\n\n\tif ( hasPastedBlocks ) {\n\t\tblocks.push( ...pastedBlocks );\n\t\tlastPastedBlockIndex += pastedBlocks.length;\n\t} else if ( onSplitMiddle ) {\n\t\tblocks.push( onSplitMiddle() );\n\t}\n\n\t// If there's pasted blocks, append a block with non empty content / after\n\t// the caret. Otherwise, do append an empty block if there is no\n\t// `onSplitMiddle` prop, but if there is and the content is empty, the\n\t// middle block is enough to set focus in.\n\tif (\n\t\thasPastedBlocks\n\t\t\t? ! isEmpty( after )\n\t\t\t: ! onSplitMiddle || ! isEmpty( after )\n\t) {\n\t\tblocks.push(\n\t\t\tonSplit(\n\t\t\t\ttoHTMLString( {\n\t\t\t\t\tvalue: after,\n\t\t\t\t\tmultilineTag,\n\t\t\t\t} ),\n\t\t\t\tisAfterOriginal\n\t\t\t)\n\t\t);\n\t}\n\n\t// If there are pasted blocks, set the selection to the last one. Otherwise,\n\t// set the selection to the second block.\n\tconst indexToSelect = hasPastedBlocks ? lastPastedBlockIndex : 1;\n\n\t// If there are pasted blocks, move the caret to the end of the selected\n\t// block Otherwise, retain the default value.\n\tconst initialPosition = hasPastedBlocks ? -1 : 0;\n\n\tonReplace( blocks, indexToSelect, initialPosition );\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,OAAO,EAAEC,KAAK,EAAEC,YAAY,QAAQ,sBAAsB;;AAEnE;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,UAAUA,CAAE;EAC3BC,KAAK;EACLC,YAAY,GAAG,EAAE;EACjBC,SAAS;EACTC,OAAO;EACPC,aAAa;EACbC;AACD,CAAC,EAAG;EACH,IAAK,CAAEH,SAAS,IAAI,CAAEC,OAAO,EAAG;IAC/B;EACD;;EAEA;EACA;EACA,MAAM;IAAEG,KAAK,GAAG,CAAC;IAAEC,GAAG,GAAG;EAAE,CAAC,GAAGP,KAAK;EACpC,MAAMQ,yBAAyB,GAAG;IAAE,GAAGR,KAAK;IAAEM,KAAK;IAAEC;EAAI,CAAC;EAC1D,MAAME,MAAM,GAAG,EAAE;EACjB,MAAM,CAAEC,MAAM,EAAEC,KAAK,CAAE,GAAGd,KAAK,CAAEW,yBAA0B,CAAC;EAC5D,MAAMI,eAAe,GAAGX,YAAY,CAACY,MAAM,GAAG,CAAC;EAC/C,IAAIC,oBAAoB,GAAG,CAAC,CAAC;;EAE7B;EACA;EACA,MAAMC,eAAe,GAAGnB,OAAO,CAAEc,MAAO,CAAC,IAAI,CAAEd,OAAO,CAAEe,KAAM,CAAC;;EAE/D;EACA;EACA;EACA;EACA,IAAK,CAAEC,eAAe,IAAI,CAAEhB,OAAO,CAAEc,MAAO,CAAC,EAAG;IAC/CD,MAAM,CAACO,IAAI,CACVb,OAAO,CACNL,YAAY,CAAE;MACbE,KAAK,EAAEU,MAAM;MACbL;IACD,CAAE,CAAC,EACH,CAAEU,eACH,CACD,CAAC;IACDD,oBAAoB,IAAI,CAAC;EAC1B;EAEA,IAAKF,eAAe,EAAG;IACtBH,MAAM,CAACO,IAAI,CAAE,GAAGf,YAAa,CAAC;IAC9Ba,oBAAoB,IAAIb,YAAY,CAACY,MAAM;EAC5C,CAAC,MAAM,IAAKT,aAAa,EAAG;IAC3BK,MAAM,CAACO,IAAI,CAAEZ,aAAa,CAAC,CAAE,CAAC;EAC/B;;EAEA;EACA;EACA;EACA;EACA,IACCQ,eAAe,GACZ,CAAEhB,OAAO,CAAEe,KAAM,CAAC,GAClB,CAAEP,aAAa,IAAI,CAAER,OAAO,CAAEe,KAAM,CAAC,EACvC;IACDF,MAAM,CAACO,IAAI,CACVb,OAAO,CACNL,YAAY,CAAE;MACbE,KAAK,EAAEW,KAAK;MACZN;IACD,CAAE,CAAC,EACHU,eACD,CACD,CAAC;EACF;;EAEA;EACA;EACA,MAAME,aAAa,GAAGL,eAAe,GAAGE,oBAAoB,GAAG,CAAC;;EAEhE;EACA;EACA,MAAMI,eAAe,GAAGN,eAAe,GAAG,CAAC,CAAC,GAAG,CAAC;EAEhDV,SAAS,CAAEO,MAAM,EAAEQ,aAAa,EAAEC,eAAgB,CAAC;AACpD"}