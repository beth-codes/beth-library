{"version":3,"names":["_dom","require","_htmlToBlocks","_registration","_parser","_interopRequireDefault","_normaliseBlocks","_specialCommentConverter","_commentRemover","_isInlineContent","_phrasingContentReducer","_headRemover","_msListConverter","_listReducer","_imageCorrector","_blockquoteNormaliser","_divNormaliser","_figureContentReducer","_shortcodeConverter","_markdownConverter","_iframeRemover","_googleDocsUidRemover","_htmlFormattingRemover","_brRemover","_utils","_emptyParagraphRemover","_slackParagraphCorrector","console","window","filterInlineHTML","HTML","preserveWhiteSpace","deepFilterHTML","headRemover","googleDocsUIDRemover","phrasingContentReducer","commentRemover","removeInvalidHTML","getPhrasingContentSchema","inline","htmlFormattingRemover","brRemover","log","maybeConvertToInline","blocks","plainText","mode","length","hasBlockSupport","name","trimRegex","trimmedPlainText","replace","indexOf","target","innerBlocks","attributes","content","pasteHandler","tagName","disableFilters","parse","String","prototype","normalize","htmlToBlocks","normaliseBlocks","isPlain","test","markdownConverter","slackParagraphCorrector","pieces","shortcodeConverter","hasShortcodes","isInlineContent","phrasingContentSchema","blockContentSchema","getBlockContentSchema","map","piece","filters","msListConverter","listReducer","imageCorrector","specialCommentConverter","iframeRemover","figureContentReducer","blockquoteNormaliser","divNormaliser","schema","emptyParagraphRemover","flat","filter","Boolean"],"sources":["@wordpress/blocks/src/api/raw-handling/paste-handler.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { getPhrasingContentSchema, removeInvalidHTML } from '@wordpress/dom';\n\n/**\n * Internal dependencies\n */\nimport { htmlToBlocks } from './html-to-blocks';\nimport { hasBlockSupport } from '../registration';\nimport parse from '../parser';\nimport normaliseBlocks from './normalise-blocks';\nimport specialCommentConverter from './special-comment-converter';\nimport commentRemover from './comment-remover';\nimport isInlineContent from './is-inline-content';\nimport phrasingContentReducer from './phrasing-content-reducer';\nimport headRemover from './head-remover';\nimport msListConverter from './ms-list-converter';\nimport listReducer from './list-reducer';\nimport imageCorrector from './image-corrector';\nimport blockquoteNormaliser from './blockquote-normaliser';\nimport divNormaliser from './div-normaliser';\nimport figureContentReducer from './figure-content-reducer';\nimport shortcodeConverter from './shortcode-converter';\nimport markdownConverter from './markdown-converter';\nimport iframeRemover from './iframe-remover';\nimport googleDocsUIDRemover from './google-docs-uid-remover';\nimport htmlFormattingRemover from './html-formatting-remover';\nimport brRemover from './br-remover';\nimport { deepFilterHTML, isPlain, getBlockContentSchema } from './utils';\nimport emptyParagraphRemover from './empty-paragraph-remover';\nimport slackParagraphCorrector from './slack-paragraph-corrector';\n\n/**\n * Browser dependencies\n */\nconst { console } = window;\n\n/**\n * Filters HTML to only contain phrasing content.\n *\n * @param {string}  HTML               The HTML to filter.\n * @param {boolean} preserveWhiteSpace Whether or not to preserve consequent white space.\n *\n * @return {string} HTML only containing phrasing content.\n */\nfunction filterInlineHTML( HTML, preserveWhiteSpace ) {\n\tHTML = deepFilterHTML( HTML, [\n\t\theadRemover,\n\t\tgoogleDocsUIDRemover,\n\t\tphrasingContentReducer,\n\t\tcommentRemover,\n\t] );\n\tHTML = removeInvalidHTML( HTML, getPhrasingContentSchema( 'paste' ), {\n\t\tinline: true,\n\t} );\n\n\tif ( ! preserveWhiteSpace ) {\n\t\tHTML = deepFilterHTML( HTML, [ htmlFormattingRemover, brRemover ] );\n\t}\n\n\t// Allows us to ask for this information when we get a report.\n\tconsole.log( 'Processed inline HTML:\\n\\n', HTML );\n\n\treturn HTML;\n}\n\n/**\n * If we're allowed to return inline content, and there is only one inlineable\n * block, and the original plain text content does not have any line breaks,\n * then treat it as inline paste.\n *\n * @param {Object} options\n * @param {Array}  options.blocks\n * @param {string} options.plainText\n * @param {string} options.mode\n */\nfunction maybeConvertToInline( { blocks, plainText, mode } ) {\n\tif (\n\t\tmode === 'AUTO' &&\n\t\tblocks.length === 1 &&\n\t\thasBlockSupport( blocks[ 0 ].name, '__unstablePasteTextInline', false )\n\t) {\n\t\tconst trimRegex = /^[\\n]+|[\\n]+$/g;\n\t\t// Don't catch line breaks at the start or end.\n\t\tconst trimmedPlainText = plainText.replace( trimRegex, '' );\n\n\t\tif (\n\t\t\ttrimmedPlainText !== '' &&\n\t\t\ttrimmedPlainText.indexOf( '\\n' ) === -1\n\t\t) {\n\t\t\tconst target = blocks[ 0 ].innerBlocks.length\n\t\t\t\t? blocks[ 0 ].innerBlocks[ 0 ]\n\t\t\t\t: blocks[ 0 ];\n\t\t\treturn target.attributes.content;\n\t\t}\n\t}\n\n\treturn blocks;\n}\n\n/**\n * Converts an HTML string to known blocks. Strips everything else.\n *\n * @param {Object}  options\n * @param {string}  [options.HTML]               The HTML to convert.\n * @param {string}  [options.plainText]          Plain text version.\n * @param {string}  [options.mode]               Handle content as blocks or inline content.\n *                                               * 'AUTO': Decide based on the content passed.\n *                                               * 'INLINE': Always handle as inline content, and return string.\n *                                               * 'BLOCKS': Always handle as blocks, and return array of blocks.\n * @param {Array}   [options.tagName]            The tag into which content will be inserted.\n * @param {boolean} [options.preserveWhiteSpace] Whether or not to preserve consequent white space.\n *\n * @param {boolean} [options.disableFilters]     Whether or not to filter non semantic content.\n * @return {Array|string} A list of blocks or a string, depending on `handlerMode`.\n */\nexport function pasteHandler( {\n\tHTML = '',\n\tplainText = '',\n\tmode = 'AUTO',\n\ttagName,\n\tpreserveWhiteSpace,\n\tdisableFilters,\n} ) {\n\t// First of all, strip any meta tags.\n\tHTML = HTML.replace( /<meta[^>]+>/g, '' );\n\t// Strip Windows markers.\n\tHTML = HTML.replace(\n\t\t/^\\s*<html[^>]*>\\s*<body[^>]*>(?:\\s*<!--\\s*StartFragment\\s*-->)?/i,\n\t\t''\n\t);\n\tHTML = HTML.replace(\n\t\t/(?:<!--\\s*EndFragment\\s*-->\\s*)?<\\/body>\\s*<\\/html>\\s*$/i,\n\t\t''\n\t);\n\n\t// If we detect block delimiters in HTML, parse entirely as blocks.\n\tif ( mode !== 'INLINE' ) {\n\t\t// Check plain text if there is no HTML.\n\t\tconst content = HTML ? HTML : plainText;\n\n\t\tif ( content.indexOf( '<!-- wp:' ) !== -1 ) {\n\t\t\treturn parse( content );\n\t\t}\n\t}\n\n\t// Normalize unicode to use composed characters.\n\t// This is unsupported in IE 11 but it's a nice-to-have feature, not mandatory.\n\t// Not normalizing the content will only affect older browsers and won't\n\t// entirely break the app.\n\t// See: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/normalize\n\t// See: https://core.trac.wordpress.org/ticket/30130\n\t// See: https://github.com/WordPress/gutenberg/pull/6983#pullrequestreview-125151075\n\tif ( String.prototype.normalize ) {\n\t\tHTML = HTML.normalize();\n\t}\n\n\tif ( disableFilters ) {\n\t\treturn maybeConvertToInline( {\n\t\t\tblocks: htmlToBlocks( normaliseBlocks( HTML ), pasteHandler ),\n\t\t\tplainText,\n\t\t\tmode,\n\t\t} );\n\t}\n\n\t// Parse Markdown (and encoded HTML) if:\n\t// * There is a plain text version.\n\t// * There is no HTML version, or it has no formatting.\n\tif ( plainText && ( ! HTML || isPlain( HTML ) ) ) {\n\t\tHTML = plainText;\n\n\t\t// The markdown converter (Showdown) trims whitespace.\n\t\tif ( ! /^\\s+$/.test( plainText ) ) {\n\t\t\tHTML = markdownConverter( HTML );\n\t\t}\n\n\t\t// Switch to inline mode if:\n\t\t// * The current mode is AUTO.\n\t\t// * The original plain text had no line breaks.\n\t\t// * The original plain text was not an HTML paragraph.\n\t\t// * The converted text is just a paragraph.\n\t\tif (\n\t\t\tmode === 'AUTO' &&\n\t\t\tplainText.indexOf( '\\n' ) === -1 &&\n\t\t\tplainText.indexOf( '<p>' ) !== 0 &&\n\t\t\tHTML.indexOf( '<p>' ) === 0\n\t\t) {\n\t\t\tmode = 'INLINE';\n\t\t}\n\t}\n\n\tif ( mode === 'INLINE' ) {\n\t\treturn filterInlineHTML( HTML, preserveWhiteSpace );\n\t}\n\n\t// Must be run before checking if it's inline content.\n\tHTML = deepFilterHTML( HTML, [ slackParagraphCorrector ] );\n\n\t// An array of HTML strings and block objects. The blocks replace matched\n\t// shortcodes.\n\tconst pieces = shortcodeConverter( HTML );\n\n\t// The call to shortcodeConverter will always return more than one element\n\t// if shortcodes are matched. The reason is when shortcodes are matched\n\t// empty HTML strings are included.\n\tconst hasShortcodes = pieces.length > 1;\n\n\tif (\n\t\tmode === 'AUTO' &&\n\t\t! hasShortcodes &&\n\t\tisInlineContent( HTML, tagName )\n\t) {\n\t\treturn filterInlineHTML( HTML, preserveWhiteSpace );\n\t}\n\n\tconst phrasingContentSchema = getPhrasingContentSchema( 'paste' );\n\tconst blockContentSchema = getBlockContentSchema( 'paste' );\n\n\tconst blocks = pieces\n\t\t.map( ( piece ) => {\n\t\t\t// Already a block from shortcode.\n\t\t\tif ( typeof piece !== 'string' ) {\n\t\t\t\treturn piece;\n\t\t\t}\n\n\t\t\tconst filters = [\n\t\t\t\tgoogleDocsUIDRemover,\n\t\t\t\tmsListConverter,\n\t\t\t\theadRemover,\n\t\t\t\tlistReducer,\n\t\t\t\timageCorrector,\n\t\t\t\tphrasingContentReducer,\n\t\t\t\tspecialCommentConverter,\n\t\t\t\tcommentRemover,\n\t\t\t\tiframeRemover,\n\t\t\t\tfigureContentReducer,\n\t\t\t\tblockquoteNormaliser,\n\t\t\t\tdivNormaliser,\n\t\t\t];\n\n\t\t\tconst schema = {\n\t\t\t\t...blockContentSchema,\n\t\t\t\t// Keep top-level phrasing content, normalised by `normaliseBlocks`.\n\t\t\t\t...phrasingContentSchema,\n\t\t\t};\n\n\t\t\tpiece = deepFilterHTML( piece, filters, blockContentSchema );\n\t\t\tpiece = removeInvalidHTML( piece, schema );\n\t\t\tpiece = normaliseBlocks( piece );\n\t\t\tpiece = deepFilterHTML(\n\t\t\t\tpiece,\n\t\t\t\t[ htmlFormattingRemover, brRemover, emptyParagraphRemover ],\n\t\t\t\tblockContentSchema\n\t\t\t);\n\n\t\t\t// Allows us to ask for this information when we get a report.\n\t\t\tconsole.log( 'Processed HTML piece:\\n\\n', piece );\n\n\t\t\treturn htmlToBlocks( piece, pasteHandler );\n\t\t} )\n\t\t.flat()\n\t\t.filter( Boolean );\n\n\treturn maybeConvertToInline( { blocks, plainText, mode } );\n}\n"],"mappings":"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"}