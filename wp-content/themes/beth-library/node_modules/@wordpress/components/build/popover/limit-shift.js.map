{"version":3,"names":["getSide","placement","split","getMainAxisFromPlacement","includes","getCrossAxis","axis","limitShift","options","fn","middlewareArguments","x","y","rects","middlewareData","offset","mainAxis","checkMainAxis","crossAxis","checkCrossAxis","coords","mainAxisCoord","crossAxisCoord","rawOffset","computedOffset","additionalFrameOffset","frameOffset","amount","len","limitMin","reference","floating","limitMax","_middlewareData$offse","_middlewareData$offse2","isOriginSide","exports"],"sources":["@wordpress/components/src/popover/limit-shift.ts"],"sourcesContent":["/**\n * External dependencies\n */\nimport type {\n\tAxis,\n\tCoords,\n\tPlacement,\n\tSide,\n\tMiddlewareArguments,\n} from '@floating-ui/react-dom';\n\n/**\n * Parts of this source were derived and modified from `floating-ui`,\n * released under the MIT license.\n *\n * https://github.com/floating-ui/floating-ui\n *\n * Copyright (c) 2021 Floating UI contributors\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n/**\n * Custom limiter function for the `shift` middleware.\n * This function is mostly identical default `limitShift` from ``@floating-ui`;\n * the only difference is that, when computing the min/max shift limits, it\n * also takes into account the iframe offset that is added by the\n * custom \"frameOffset\" middleware.\n *\n * All unexported types and functions are also from the `@floating-ui` library,\n * and have been copied to this file for convenience.\n */\n\ntype LimitShiftOffset =\n\t| ( ( args: MiddlewareArguments ) =>\n\t\t\t| number\n\t\t\t| {\n\t\t\t\t\t/**\n\t\t\t\t\t * Offset the limiting of the axis that runs along the alignment of the\n\t\t\t\t\t * floating element.\n\t\t\t\t\t */\n\t\t\t\t\tmainAxis?: number;\n\t\t\t\t\t/**\n\t\t\t\t\t * Offset the limiting of the axis that runs along the side of the\n\t\t\t\t\t * floating element.\n\t\t\t\t\t */\n\t\t\t\t\tcrossAxis?: number;\n\t\t\t  } )\n\t| number\n\t| {\n\t\t\t/**\n\t\t\t * Offset the limiting of the axis that runs along the alignment of the\n\t\t\t * floating element.\n\t\t\t */\n\t\t\tmainAxis?: number;\n\t\t\t/**\n\t\t\t * Offset the limiting of the axis that runs along the side of the\n\t\t\t * floating element.\n\t\t\t */\n\t\t\tcrossAxis?: number;\n\t  };\n\ntype LimitShiftOptions = {\n\t/**\n\t * Offset when limiting starts. `0` will limit when the opposite edges of the\n\t * reference and floating elements are aligned.\n\t * - positive = start limiting earlier\n\t * - negative = start limiting later\n\t */\n\toffset: LimitShiftOffset;\n\t/**\n\t * Whether to limit the axis that runs along the alignment of the floating\n\t * element.\n\t */\n\tmainAxis: boolean;\n\t/**\n\t * Whether to limit the axis that runs along the side of the floating element.\n\t */\n\tcrossAxis: boolean;\n};\n\nfunction getSide( placement: Placement ): Side {\n\treturn placement.split( '-' )[ 0 ] as Side;\n}\n\nfunction getMainAxisFromPlacement( placement: Placement ): Axis {\n\treturn [ 'top', 'bottom' ].includes( getSide( placement ) ) ? 'x' : 'y';\n}\n\nfunction getCrossAxis( axis: Axis ): Axis {\n\treturn axis === 'x' ? 'y' : 'x';\n}\n\nexport const limitShift = (\n\toptions: Partial< LimitShiftOptions > = {}\n): {\n\toptions: Partial< LimitShiftOffset >;\n\tfn: ( middlewareArguments: MiddlewareArguments ) => Coords;\n} => ( {\n\toptions,\n\tfn( middlewareArguments ) {\n\t\tconst { x, y, placement, rects, middlewareData } = middlewareArguments;\n\t\tconst {\n\t\t\toffset = 0,\n\t\t\tmainAxis: checkMainAxis = true,\n\t\t\tcrossAxis: checkCrossAxis = true,\n\t\t} = options;\n\n\t\tconst coords = { x, y };\n\t\tconst mainAxis = getMainAxisFromPlacement( placement );\n\t\tconst crossAxis = getCrossAxis( mainAxis );\n\n\t\tlet mainAxisCoord = coords[ mainAxis ];\n\t\tlet crossAxisCoord = coords[ crossAxis ];\n\n\t\tconst rawOffset =\n\t\t\ttypeof offset === 'function'\n\t\t\t\t? offset( middlewareArguments )\n\t\t\t\t: offset;\n\t\tconst computedOffset =\n\t\t\ttypeof rawOffset === 'number'\n\t\t\t\t? { mainAxis: rawOffset, crossAxis: 0 }\n\t\t\t\t: { mainAxis: 0, crossAxis: 0, ...rawOffset };\n\n\t\t// At the moment of writing, this is the only difference\n\t\t// with the `limitShift` function from `@floating-ui`.\n\t\t// This offset needs to be added to all min/max limits\n\t\t// in order to make the shift-limiting work as expected.\n\t\tconst additionalFrameOffset = {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\t...middlewareData.frameOffset?.amount,\n\t\t};\n\n\t\tif ( checkMainAxis ) {\n\t\t\tconst len = mainAxis === 'y' ? 'height' : 'width';\n\t\t\tconst limitMin =\n\t\t\t\trects.reference[ mainAxis ] -\n\t\t\t\trects.floating[ len ] +\n\t\t\t\tcomputedOffset.mainAxis +\n\t\t\t\tadditionalFrameOffset[ mainAxis ];\n\t\t\tconst limitMax =\n\t\t\t\trects.reference[ mainAxis ] +\n\t\t\t\trects.reference[ len ] -\n\t\t\t\tcomputedOffset.mainAxis +\n\t\t\t\tadditionalFrameOffset[ mainAxis ];\n\n\t\t\tif ( mainAxisCoord < limitMin ) {\n\t\t\t\tmainAxisCoord = limitMin;\n\t\t\t} else if ( mainAxisCoord > limitMax ) {\n\t\t\t\tmainAxisCoord = limitMax;\n\t\t\t}\n\t\t}\n\n\t\tif ( checkCrossAxis ) {\n\t\t\tconst len = mainAxis === 'y' ? 'width' : 'height';\n\t\t\tconst isOriginSide = [ 'top', 'left' ].includes(\n\t\t\t\tgetSide( placement )\n\t\t\t);\n\t\t\tconst limitMin =\n\t\t\t\trects.reference[ crossAxis ] -\n\t\t\t\trects.floating[ len ] +\n\t\t\t\t( isOriginSide\n\t\t\t\t\t? middlewareData.offset?.[ crossAxis ] ?? 0\n\t\t\t\t\t: 0 ) +\n\t\t\t\t( isOriginSide ? 0 : computedOffset.crossAxis ) +\n\t\t\t\tadditionalFrameOffset[ crossAxis ];\n\t\t\tconst limitMax =\n\t\t\t\trects.reference[ crossAxis ] +\n\t\t\t\trects.reference[ len ] +\n\t\t\t\t( isOriginSide\n\t\t\t\t\t? 0\n\t\t\t\t\t: middlewareData.offset?.[ crossAxis ] ?? 0 ) -\n\t\t\t\t( isOriginSide ? computedOffset.crossAxis : 0 ) +\n\t\t\t\tadditionalFrameOffset[ crossAxis ];\n\n\t\t\tif ( crossAxisCoord < limitMin ) {\n\t\t\t\tcrossAxisCoord = limitMin;\n\t\t\t} else if ( crossAxisCoord > limitMax ) {\n\t\t\t\tcrossAxisCoord = limitMax;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\t[ mainAxis ]: mainAxisCoord,\n\t\t\t[ crossAxis ]: crossAxisCoord,\n\t\t} as Coords;\n\t},\n} );\n"],"mappings":"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"}